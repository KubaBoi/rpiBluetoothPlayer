<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="sheet.css">
</head>
<body>
    <div id="main">
        <div id="control">
            <button id="prev" class="prev" onclick="sendUpdate(2)"></button>
            <button id="play" class="play1" onclick="play()"></button>
            <button id="next" class="next" onclick="sendUpdate(3)"></button>
        </div>
        <div id="titles">
            <h1 id="title"></h1>
            <h3 id="artist"></h3>
            <h3 id="album"></h3>
        </div>
    </div>

    <script>
        playing = false;

        playButton = document.querySelector("#play");

        title = document.querySelector("#title");
        artist = document.querySelector("#artist");
        album = document.querySelector("#album");

        function play() {
            if (playing) sendUpdate(0);
            else sendUpdate(1);
        }

        setInterval(update, 1000);
        function update() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    json = JSON.parse(this.responseText);
                    console.log(json);
                    title.innerHTML = json.Track.Title;
                    artist.innerHTML = json.Track.Artist;
                    album.innerHTML = json.Track.Album;
                    
                    if (json.Status == "playing") playing = true;
                    else playing = false;

                    documentUpdate();
                }
            };
            xhttp.open("GET", "/update", true);
            xhttp.send();
        }

        function sendUpdate(update) {
            var xmlhttp = new XMLHttpRequest();  
            var theUrl = "/sendUpdate";
            xmlhttp.open("POST", theUrl);
            xmlhttp.setRequestHeader("Content-Type", "application/text;charset=UTF-8");
            xmlhttp.send(update);
        }

        function documentUpdate() {
            if (playing) {
                playButton.setAttribute("class", "play1");
            }
            else {
                playButton.setAttribute("class", "play0");
            }
        }
    </script>
</body>